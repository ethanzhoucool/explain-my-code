<!DOCTYPE html>
<html>
<head>
    <title>Code Explanation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Code Explanation</h1>
        
        <div class="badges">
            <span class="level-badge">{{ level|replace('_', ' ')|title }} Mode</span>
            <span class="mode-badge {% if mode == 'ai' %}mode-ai{% else %}mode-rule{% endif %}">
                {% if mode == 'ai' %}ðŸ¤– AI-Powered{% else %}âš¡ Rule-based{% endif %}
            </span>
        </div>
        
        <h2>{{ language|title }} Code</h2>
        {% if mode == 'ai' %}
        <p class="instruction">Hover over each line for AI-generated explanations</p>
        {% else %}
        <p class="instruction">Hover over highlighted keywords for explanations</p>
        {% endif %}
        
        <div class="code-container">
            {% for line in annotated_lines %}
            <div class="code-line">
                <div class="line-number">{{ line.number }}</div>
                <div class="line-content">{{ line.highlighted|safe }}</div>
            </div>
            {% endfor %}
        </div>
        
        {% if mode == 'ai' and ai_explanation %}
        <h2>Summary</h2>
        <div class="ai-explanation-box">
            {{ ai_explanation }}
        </div>
        {% endif %}
        
        <!-- Mode toggle button -->
        <div class="mode-toggle">
            {% if mode == 'rule-based' %}
            <form method="POST" action="/explain">
                <input type="hidden" name="code" value="{{ code }}">
                <input type="hidden" name="language" value="{{ language }}">
                <input type="hidden" name="level" value="{{ level }}">
                <input type="hidden" name="mode" value="ai">
                <button type="submit" class="toggle-btn ai-btn">ðŸ¤– Switch to AI-Powered Explanation</button>
            </form>
            {% else %}
            <form method="POST" action="/explain">
                <input type="hidden" name="code" value="{{ code }}">
                <input type="hidden" name="language" value="{{ language }}">
                <input type="hidden" name="level" value="{{ level }}">
                <input type="hidden" name="mode" value="rule-based">
                <button type="submit" class="toggle-btn rule-btn">âš¡ Switch to Rule-based Explanation</button>
            </form>
            {% endif %}
        </div>
        
        <a href="/" class="back-link">Explain Another Code</a>
    </div>
    <footer>
        Built by Ethan Zhou | <a href="https://github.com/ethanzhoucool/explain-my-code">View on GitHub</a>
    </footer>
    <!-- Load JavaScript for tooltips (both modes now have highlighting) -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>